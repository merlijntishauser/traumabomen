map $host $og_lang {
    "~*traumabomen"  "nl";
    default          "en";
}

map $host $og_locale {
    "~*traumabomen"  "nl_NL";
    default          "en_US";
}

map $host $og_title {
    "~*traumabomen"  "Traumabomen";
    default          "Traumatrees";
}

map $host $og_desc {
    "~*traumabomen"  "Breng intergenerationeel trauma in kaart op visuele stambomen. Jouw data blijft van jou.";
    default          "Map intergenerational trauma onto visual family trees. Your data stays yours.";
}

map $host $og_origin {
    "~*traumabomen"  "https://www.traumabomen.nl";
    default          "https://www.traumatrees.org";
}

server {
    listen 8080;
    root /usr/share/nginx/html;
    index index.html;

    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains" always;

    sub_filter_once off;
    sub_filter '__OG_LANG__'   $og_lang;
    sub_filter '__OG_LOCALE__' $og_locale;
    sub_filter '__OG_TITLE__'  $og_title;
    sub_filter '__OG_DESC__'   $og_desc;
    sub_filter '__OG_ORIGIN__' $og_origin;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /assets/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    location /api/ {
        proxy_pass ${API_URL}/;
        proxy_ssl_server_name on;
        proxy_set_header Host $proxy_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
